<!DOCTYPE html>
<html lang="zh-cmn-Hans">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <link rel="icon" href="<%= BASE_URL %>favicon.ico">
    <title>名片之家自助下单系统</title>
    <script>
      var _hmt = _hmt || [];
      (function() {
        var hm = document.createElement("script");
        // hm.src = "https://hm.baidu.com/hm.js?20696d8180c030d4dc34d6c2316f7f48";
        hm.src = "https://hm.baidu.com/hm.js?f929fe67a558f511aafdfb2692bc264d";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
      })();
    </script>
    <!-- <script charset="utf-8" src="https://wpa.b.qq.com/cgi/wpa.php"></script> -->
    <style>
      .for-ie-message-box {
        display: none;
        color: #333;
        *display: block;
        display: block\9;
        display: none\9\0;
        margin-top: 20px;
        margin-left: 12px;
        font-family: Arial, Helvetica, sans-serif;
      }
      @media screen and (min-width:0\0) {
        /* IE 9 10 隐藏 */
        #app {
          display: none;
        }
      }

      @media screen and (-ms-high-contrast: active), (-ms-high-contrast: none) {
        /* IE 10 显示 */
        #app {
          display: block;
        }
      }
    </style>
  </head>
  <body>
    <noscript>
      <strong>名片之家自助下单系统</strong>
    </noscript>
    <!--[if lt IE 10]>
    <p class='for-ie-message-box'>
        当前浏览器版本过低，请升级浏览器，IE浏览器已经停止维护，推荐使用chrome、Edge、火狐、360极速版等浏览器
    </p>
    <![endif]-->
    <div id="app">
    </div>
    <!-- built files will be auto injected -->
  </body>

  <script>
    var _$53= _$53 || [];//注：预定义对象，变量名不可更改，使用前请检查是否和自身网站变量名冲突
    var _setGuestInfo = {
      // id:'1000051',
      // name:'dai',
      // email:'11@163.com',
      // qq:'111111',
      // phone:'15248963256',
      // company:'111',
      // address:'111',
      // notes:'111',
      // custom_info:'1112'
    }
    // console.log(window.kefuOperate.getCookie());
    // console.log(window.kefuOperate.setGuestInfo());
    var cookieData = null;
    var kefuOperate = {
      getCookieInfo: function () {
        var cookieStr = document.cookie;
        var start = cookieStr.indexOf('customerInfo=')
        if (start === -1) return
        if (start !== -1)  start += 'customerInfo'.length + 1
        var end = cookieStr.indexOf(';', start);
        customerInfo = JSON.parse(cookieStr.substring(start,end === -1 ? cookieStr.length:end))
        if (start === -1) {
          cookieData = null;
        }else{
          cookieData = customerInfo;
        };

      },
      setGuestInfo: function () {
        if (cookieData === null) return
        _setGuestInfo.name = (cookieData.CustomerName || '') + '('+(cookieData.CustomerSN || '')+')'
        _setGuestInfo.phone = cookieData.Mobile
        // 微信
        _setGuestInfo.weixin = (cookieData.Type.Second || '') + (cookieData.Grade.Second || '')
        _setGuestInfo.qq = cookieData.QQ
        _setGuestInfo.email = cookieData.Location ? cookieData.Location.RegionalName || '其他大区' : ''
        _setGuestInfo.notes =
        (cookieData.AuthenInfo.SellArea ? cookieData.AuthenInfo.SellArea.RegionalName || '' : '')+
        (cookieData.AuthenInfo.SellArea ? cookieData.AuthenInfo.SellArea.CityName || '' : '')+
        (cookieData.AuthenInfo.SellArea ? cookieData.AuthenInfo.SellArea.CountyName || '': '')
      }
    }
    window.kefuOperate.getCookieInfo();
    window.kefuOperate.setGuestInfo();
    _$53.push(["_setGuestInfo",_setGuestInfo]);
    (function() {var _53code = document.createElement("script");_53code.src =
    "https://tb.53kf.com/code/code/14ad3ef85e1f535e51e6c70a9081bb8d1/1";var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(_53code, s);})();
  </script>

  <!--  -->
  <script>
    window.onload = function () {
      var searchStr = window.location.search.replace(/^\?/, '');
      
      if (!searchStr) return;

      var obj = {};

      function getParams(str) {
        if (!str) {
          return;
        }

        var arr = str.split('&');

        for (var i = 0; i < arr.length; i++) {
          var item = arr[i];
          if (item) {
            var tempArr = item.split('=');
            if (tempArr.length === 2) {
              obj[tempArr[0]] = tempArr[1];
            }
          }
        }
      }
      
      getParams(searchStr);

      if (obj.state) {
        getParams(decodeURIComponent(obj.state).replace(/\?/g, '&'));
      }

      if (obj.routePath) {
        var routePath = obj.routePath;
        var AuthPath = obj.AuthPath;

        delete obj.state;
        delete obj.routePath;
        delete obj.AuthPath;

        var keys = Object.keys(obj);
        var queryArr = [];
        for (var i = 0; i < keys.length; i++) {
          var key = keys[i];
          var val = obj[key];
          queryArr.push(key + '=' + val);
        }
        var queryStr = queryArr.join('&');

        var url = '/#' + routePath;
        if (queryStr) {
          url += '?';
          url += queryStr;
        }

        window.location = (window.location.origin + window.location.pathname).replace(AuthPath, '') + url;
      }
    }
  </script>
</html>
